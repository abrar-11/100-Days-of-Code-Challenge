<!-- =======Header===== -->
<%- include('./includes/_header.ejs'); %> <%- include('./includes/_table.ejs',
{employees: employee}); %>

<!-- Add Modal HTML

-->
<div id="addEmployeeModal" class="modal fade">
   <div class="modal-dialog">
      <div class="modal-content">
         <form id="add_employee">
            <div class="modal-header">
               <h4 class="modal-title">Add Employee</h4>
               <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-hidden="true"
               >
                  &times;
               </button>
            </div>
            <div class="modal-body">
               <div class="form-group">
                  <label>Name</label>
                  <input
                     type="text"
                     class="form-control"
                     id="add_name"
                     required
                  />
               </div>
               <div class="form-group">
                  <label>Email</label>
                  <input
                     type="email"
                     class="form-control"
                     id="add_email"
                     required
                  />
               </div>
               <div class="form-group">
                  <label>Address</label>
                  <textarea
                     class="form-control"
                     required
                     id="add_address"
                  ></textarea>
               </div>
               <div class="form-group">
                  <label>Phone</label>
                  <input
                     type="text"
                     class="form-control"
                     id="add_phone"
                     required
                  />
               </div>
            </div>
            <div class="modal-footer">
               <input
                  type="button"
                  class="btn btn-default"
                  data-dismiss="modal"
                  value="Cancel"
               />
               <input type="submit" class="btn btn-success" value="Add" />
            </div>
         </form>
      </div>
   </div>
</div>

<!-- Edit Modal HTML -->
<div id="editEmployeeModal" class="modal fade">
   <div class="modal-dialog">
      <div class="modal-content">
         <form id="edit_employee">
            <div class="modal-header">
               <h4 class="modal-title">Edit Employee</h4>
               <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-hidden="true"
               >
                  &times;
               </button>
            </div>
            <div class="modal-body">
               <div class="form-group">
                  <label>Name</label>
                  <input
                     type="text"
                     class="form-control"
                     id="edit_name"
                     required
                  />
               </div>
               <div class="form-group">
                  <label>Email</label>
                  <input
                     type="email"
                     class="form-control"
                     id="edit_email"
                     required
                  />
               </div>
               <div class="form-group">
                  <label>Address</label>
                  <textarea
                     class="form-control"
                     id="edit_address"
                     required
                  ></textarea>
               </div>
               <div class="form-group">
                  <label>Phone</label>
                  <input
                     type="text"
                     class="form-control"
                     id="edit_phone"
                     required
                  />
               </div>
            </div>
            <div class="modal-footer">
               <input
                  type="button"
                  class="btn btn-default"
                  data-dismiss="modal"
                  value="Cancel"
               />
               <input type="submit" class="btn btn-info" value="Save" />
            </div>
         </form>
      </div>
   </div>
</div>

<script>
   const edit_employee_form = document.getElementById("edit_employee");
   let edit_name = document.getElementById("edit_name");
   let edit_email = document.getElementById("edit_email");
   let edit_address = document.getElementById("edit_address");
   let edit_phone = document.getElementById("edit_phone");

   edit_employee_form.addEventListener("submit", async (event) => {
      event.preventDefault();
      console.log(edit_employee_form.attributes);
      const id = edit_employee_form.getAttribute("data-emp-id");
      const result = await fetch(`/api/update/${id}`, {
         method: "PUT",
         headers: {
            "content-type": "application/json",
         },
         body: JSON.stringify({
            name: edit_name.value,
            email: edit_email.value,
            address: edit_address.value,
            phone: edit_phone.value,
         }),
      }).then((res) => res.json());

      console.log(result);
      if (result.status == "success") {
         alert("Employee Updated Successfully");
         name.value = "";
         email.value = "";
         address.value = "";
         phone.value = "";

         location.reload();
      } else {
         alert(result.error);
      }
   });

   const editEmployee = async (id) => {
      console.log("id: ", id);
      const result = await fetch(`/api/getemployee?id=${id}`).then((res) =>
         res.json()
      );

      edit_employee_form.dataset.empId= id

      console.log(result);
      if (result.status == "success") {
         const data = result.data;
         edit_name.value = data.name;
         edit_email.value = data.email;
         edit_address.value = data.address;
         edit_phone.value = data.phone;
      } else {
         alert(result.error);
      }
   };
</script>
<!-- Delete Modal HTML -->
<div id="deleteEmployeeModal" class="modal fade">
   <div class="modal-dialog">
      <div class="modal-content">
         <form>
            <div class="modal-header">
               <h4 class="modal-title">Delete Employee</h4>
               <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-hidden="true"
               >
                  &times;
               </button>
            </div>
            <div class="modal-body">
               <p>Are you sure you want to delete these Records?</p>
               <p class="text-warning">
                  <small>This action cannot be undone.</small>
               </p>
            </div>
            <div class="modal-footer">
               <input
                  type="button"
                  class="btn btn-default"
                  data-dismiss="modal"
                  value="Cancel"
               />
               <input type="submit" class="btn btn-danger" value="Delete" />
            </div>
         </form>
      </div>
   </div>
</div>

<script>
   const add_employee_form = document.getElementById("add_employee");

   add_employee_form.addEventListener("submit", async (event) => {
      event.preventDefault();
      let name = document.getElementById("add_name");
      let email = document.getElementById("add_email");
      let address = document.getElementById("add_address");
      let phone = document.getElementById("add_phone");

      const result = await fetch("/api/employee", {
         method: "POST",
         headers: {
            "content-type": "application/json",
         },
         body: JSON.stringify({
            name: name.value,
            email: email.value,
            address: address.value,
            phone: phone.value,
         }),
      }).then((res) => res.json());

      console.log(result);
      if (result.status == "success") {
         alert("Employee Added Successfully");
         name.value = "";
         email.value = "";
         address.value = "";
         phone.value = "";

         location.reload();
      } else {
         alert(result.error);
      }
   });
</script>
<script>
   $(document).ready(function () {
      // Activate tooltip
      $('[data-toggle="tooltip"]').tooltip();

      // Select/Deselect checkboxes
      var checkbox = $('table tbody input[type="checkbox"]');
      $("#selectAll").click(function () {
         if (this.checked) {
            checkbox.each(function () {
               this.checked = true;
            });
         } else {
            checkbox.each(function () {
               this.checked = false;
            });
         }
      });
      checkbox.click(function () {
         if (!this.checked) {
            $("#selectAll").prop("checked", false);
         }
      });
   });
</script>

<!-- =======Footer===== -->
<%-include('./includes/_footer.ejs'); %>
